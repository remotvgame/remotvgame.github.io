<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>REMO TV â€“ Live Channels</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
  <style>
    body { background:#f8f9fa; font-family: 'Cairo', sans-serif; }
    .logo { width:60px; height:60px; object-fit:cover; border-radius:.375rem; }
    .card { cursor:pointer; transition:.2s; }
    .card:hover { transform:translateY(-2px); box-shadow:0 .5rem 1rem rgba(0,0,0,.15); }
  </style>
</head>
<body>
  <div class="container py-4">
    <h1 class="mb-4 text-center">ðŸ“º REMO TV â€“ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª</h1>

    <!-- categories will be injected here -->
    <div id="root"></div>

    <!-- player modal -->
    <div class="modal fade" id="playerModal" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="playerTitle"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body p-0">
            <video id="player" controls class="w-100" style="max-height:70vh;"></video>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/dashjs@4.7.4/dist/dash.all.min.js"></script>

  <!-- firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";
    import { firebaseConfig } from "./firebase-config.js";

    const app  = initializeApp(firebaseConfig);
    const db   = getDatabase(app);

    // fetch the data
    const snapshot = await get(ref(db));
    const data = snapshot.val();

    // helper
    const safeUrl = url => url.startsWith('http') ? url : null;

    const play = (title, url, scheme) => {
      const video = document.getElementById('player');
      document.getElementById('playerTitle').textContent = title;
      video.pause();

      if (url.includes('.m3u8') && Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
      } else if (url.includes('.mpd')) {
        const dash = dashjs.MediaPlayer().create();
        dash.initialize(video, url, true);
      } else {
        video.src = url;
        video.play();
      }

      new bootstrap.Modal('#playerModal').show();
    };

    // render
    const root = document.getElementById('root');
    const cats = {
      ent: 'ÙˆØ«Ø§Ø¦Ù‚ÙŠØ§Øª',
      islamic: 'Ø¥Ø³Ù„Ø§Ù…ÙŠØ©',
      kids: 'Ø£Ø·ÙØ§Ù„',
      news: 'Ø¥Ø®Ø¨Ø§Ø±ÙŠØ©',
      sport: 'Ø±ÙŠØ§Ø¶ÙŠØ©',
      'sport+': 'Ø±ÙŠØ§Ø¶ÙŠØ© +',
      remo: 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'
    };

    Object.entries(data).forEach(([catKey, channels]) => {
      if (catKey === 'remo') return; // skip meta
      const catDiv = document.createElement('section');
      catDiv.className = 'mb-5';
      catDiv.innerHTML = `<h2 class="mb-3">${cats[catKey] || catKey}</h2>
                          <div class="row g-3" id="cat-${catKey}"></div>`;
      root.appendChild(catDiv);

      const row = document.getElementById(`cat-${catKey}`);
      Object.values(channels).forEach(ch => {
        const link = safeUrl(ch.link1 || ch.link2 || ch.link3 || ch.link4 || ch.link5);
        if (!link) return;

        const col = document.createElement('div');
        col.className = 'col-6 col-sm-4 col-md-3 col-lg-2';
        col.innerHTML = `
          <div class="card h-100" onclick="window.playChannel('${ch['name ar']}', '${link}', '${ch.scheme1 || ''}')">
            <img src="${ch.logolink || ''}" class="card-img-top logo mx-auto mt-2" alt="">
            <div class="card-body p-2 text-center">
              <small class="fw-bold">${ch['name ar']}</small>
            </div>
          </div>`;
        row.appendChild(col);
      });
    });

    // attach global helper
    window.playChannel = play;
  </script>
</body>
</html>
